<template name="discussion">
	<div class="discussion-titlebar">
		<h4 class="discussion-heading">
			<span class="fa fa-comments"></span>
			&nbsp;
			{{mf 'course.title.Discussion' 'Discussion'}}
		</h4>
	</div>
	{{#if havePosts}}
		{{#each posts}}
			<div class="discussion-conversation">
				{{> post}}
			</div>
		{{/each}}
	{{/if}}
		{{> post newPost}}
</template>

<template name="post">
	{{#if editing}}
		{{> postEdit}}
	{{else}}
		{{> postShow}}
	{{/if}}
	{{#each responses}}
		{{> post}}
	{{/each}}
	{{#if allowResponse}}
		{{> post newResponse}}
	{{/if}}
</template>

<template name="postShow">
	{{#if new}}
		{{#if parentId}}
			<button type="button" class="-edit discussion-reply-btn" role="button">
				<span class="fa fa-reply"></span>
				&nbsp;
				{{mf 'course.discussion.comment_answer' 'Answer'}}
			</button>
		{{else}}
			<button type="button" class="-edit discussion-new-post-btn">
				<span class="glyphicon glyphicon-pencil"></span>
				&nbsp;
				{{mf 'course.discussion.write_comment' 'Write a comment'}}
			</button>
		{{/if}}
	{{else}}
		<div class="{{postClass}}">
			{{>iconProfilelink userId}}
			<span class="comment-time-created" title="{{dateformat time_created}}">
				{{fromNow time_created}}
			</span>
			{{#if time_updated}}
				<span class="comment-time-updated" title="{{dateformat time_updated}}">
					last update:{{fromNow time_updated}}
				</span>
			{{/if}}
			<h4 class="comment-title">{{this.title}}</h4>
			<p>{{text}}</p>
			{{#if mayDelete}}
				<button type="button" class="discussion-delete-btn delete" role="button">
					<span class="glyphicon glyphicon-remove"></span>
					&nbsp;
					{{mf 'course.details.del_btn' 'Delete'}}
				</button>
			{{/if}}
			{{#if mayEdit}}
				<button type="button" class="-edit discussion-edit-btn" role="button">
					<span class="glyphicon glyphicon-edit"></span>
					&nbsp;
					{{mf 'course.discussion.comment_edit' 'Edit'}}
				</button>
			{{/if}}
		</div>
	{{/if}}
</template>

<template name="postEdit">
	<div class='{{postClass}} {{#if new}}{{#unless parentId}}discussion-new-post{{/unless}}{{/if}}'>
		{{#if showUserId}}
			{{> iconProfilelink userId}}
		{{else}}
			<span class="fa fa-user-secret"></span>
			&nbsp;
			<strong>{{mf 'discussion.anonymous' 'Anonymous'}}</strong>
		{{/if}}
		<span class="comment-time-created">
			{{#unless new}}
				{{fromNow time_created}}
			{{/unless}}
		</span>
		{{#if time_updated}}
			<span class="comment-time-updated">
				last update:{{fromNow time_updated}}
			</span>
		{{/if}}
		<div class="discussion-edit {{#if parentId}}answer{{/if}}">
			<input
				type="text"
				class="-postTitle discussion-edit-title"
				placeholder="{{mf 'course.discussion.title_placeholder' 'Title'}}"
				value="{{title}}"
			/>
			<textarea	class="-postText discussion-edit-text"	placeholder="{{#if parentId}}{{mf 'course.discussion.text_placeholder_answer' 'Your answer'}}{{else}}{{mf 'course.discussion.text_placeholder' 'Your comment'}}{{/if}}">
				{{text}}
			</textarea>
			<button type="button" class="discussion-cancel-btn cancel">
				{{mf 'course.discussion.comment_btn.cancel' 'Cancel'}}
			</button>
			<button type="button" class="discussion-save-btn post">
				{{#if new}}
					{{#if parentId}}
						{{mf 'course.discussion.comment_btn.answer' 'Answer!'}}
					{{else}}
						{{mf 'course.discussion.comment_btn.write' 'Write!'}}
					{{/if}}
				{{else}}
						{{mf 'course.discussion.comment_btn.update' 'Update my comment!'}}
				{{/if}}
			</button>
			{{#if new}}
				<label class="discussion-toggle-anonymous">
					<input type='checkbox' class='toggleAnonymous' {{anonChecked}} {{anonDisabled}}>
					{{mf 'course.discussion.anon' 'Anonymous comment'}}&nbsp;
					<span class="fa fa-user-secret"></span>&nbsp;
				</label>
			{{/if}}
		</div>
	</div>
</template>


<template name="iconProfilelink">
	{{#if this}}
		<a class="discussion-profile-link" href="/user/{{this}}/{{username this}}">
			<span class="discussion-profile-icon glyphicon glyphicon-user"></span>
			&nbsp;
			{{username this}}
		</a>
	{{else}}
		<span style="color: grey;" class="glyphicon glyphicon-user"></span>
		{{mf 'noUser_placeholder' 'someone'}}
	{{/if}}
</template>
